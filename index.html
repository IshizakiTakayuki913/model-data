<html>
  <head>
    <meta charset="utf-8" />
    <title>quaternion sample</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.8thwall.com/web/aframe/aframe-extras-6.1.1.min.js"></script>

    <script src="./solve.js"></script>
    <link rel="stylesheet" href="./style.css">
  </head>
  <script type="text/javascript">

    AFRAME.registerComponent('press-key-board', {
      schema: {
        view_mode: {type: 'bool', default: false},
        btn_pos: {type: 'vec2', default: {x:0, y:0}},
        view_pres_rad: {type: 'vec3', default: {x:0, y:0, z:0}},
        view_rad: {type: 'vec3', default: {x:0, y:0, z:0}},
        dis: {type: 'vec2', default: {x:0, y:0}},
        Space_key: {type: 'bool', default: false},
      },
      
      init() {
        const screen = document.getElementById("screen")
        const btn1 = document.getElementById("btn1")
        const btn2 = document.getElementById("btn2")
        const camera = document.getElementById("camera")
        const camera2 = document.getElementById("camera2")
        const body = document.getElementById("body")
        const hand = document.getElementById("hand")
        
        this.data.btn_pos = {x: document.body.clientWidth - 100, y: 100}
        btn2.style.left = this.data.btn_pos.x
        btn2.style.top = this.data.btn_pos.y
        
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        // ctx.beginPath();
        // ctx.ellipse(50, 50, 50, 50, 0, Math.PI * 2, 0);
        // ctx.stroke();


        btn1.addEventListener('click', () => {
          // rotate("F");
          rotate("R U R' F' R U R' U' R' F R2 U' R' U'")
        });
        btn2.addEventListener('mousedown', (e) => {
          // console.log("mousedown");
          screen.style.display = "block"
          // console.log("this.view_mode "+this.data.view_mode)
          this.data.view_mode = true

          this.data.btn_pos.x = e.clientX
          this.data.btn_pos.y = e.clientY

          this.data.view_pres_rad = {x:this.data.view_rad.x, y:this.data.view_rad.y, z:this.data.view_rad.z}
        });

        btn2.addEventListener('wheel', (e) => {
          camera2.object3D.position.z -= e.deltaY/200
        });

        screen.addEventListener('mouseup', () => {
          screen.style.display = "none"
          this.data.view_mode = false
        });

        screen.addEventListener('mousemove', (e) => {
          this.data.dis.x = e.clientX - this.data.btn_pos.x
          this.data.dis.y = e.clientY - this.data.btn_pos.y
          // console.log("\nview_pres_rad.x:"+this.data.view_pres_rad.x+" view_pres_rad.y:"+this.data.view_pres_rad.y)
          // console.log("dis.x:"+this.data.dis.x+" dis.y:"+this.data.dis.y)


          this.data.view_rad.y = this.data.view_pres_rad.y - this.data.dis.y
          this.data.view_rad.y = Math.min(Math.max(-50,this.data.view_rad.y),50)

          this.data.view_rad.x = this.data.view_pres_rad.x - this.data.dis.x
          a = ((this.data.view_rad.x + 50 ) % 100 ) - 50
          a = Math.min(Math.max(-50,a),50)

          // console.log("view_rad.x:"+this.data.view_rad.x+" view_rad.y:"+this.data.view_rad.y)

          ctx.clearRect(0, 0, 100, 100);

          ctx.beginPath();
          ctx.fillStyle = "#0f0";
          ctx.ellipse(50, 50, Math.abs(a), 50, 0, Math.PI * 2, 0);
          ctx.stroke();

          ctx.beginPath();
          ctx.fillStyle = "#00f";
          ctx.ellipse(50, 50, 50, Math.abs(this.data.view_rad.y), 0, Math.PI * 2, 0);
          ctx.stroke();

          camera.setAttribute("rotation", {x:this.data.view_rad.y * 1.8, y:this.data.view_rad.x * 1.8, z:0})
        });

        body.addEventListener("keydown", (e) => {
          const A = e.code.indexOf("Key")
          const M = 'UDLRBF'
          // console.log(`${e.code} ${A}`)
          if(A == 0 && M.indexOf(e.code[3]) != -1){
            let sulb = e.code[3]
            if(e.shiftKey) sulb+="'"
            else if(this.data.Space_key) sulb+="2"
            rotate(sulb)
            if(sulb == "U'"){
              console.log("hand animation")
              console.log(hand)
              // setTimeout(() => {
              // }, time)
              hand.setAttribute('animation-mixer', {
                clip: 'T-U',
                // loop: 'repeat',
                // timeScale: 1,
              })
              // time += 1500
            }
          }
          else if(e.code == "Space")
            this.data.Space_key = true
        })
        
        body.addEventListener("keyup", (e) => {
          // const A = e.code.indexOf("Key")
          // const M = 'UDLRBF'
          // console.log(`${e.code} ${A}`)
          // if(A == 0 && M.indexOf(e.code[3]) != -1){
          //   let sulb = e.code[3]
          //   if(e.shiftKey) sulb+="'"
          //   else if(e.altKey) sulb+="2"
          //   rotate(sulb)
          // }
          // else 
          if(e.code == "Space")
            this.data.Space_key = false
        })
      },
    });

    // AFRAME.registerComponent('buttons', {
    //   init: function () {
    //     let btn1 = document.getElementById("btn1");
    //     btn1.addEventListener('click', () => {
    //       rotate('R');
    //     });
    //   },
    // });
    // <div id="btn1" class="btn"></div>
  </script>
  <body id="body">

    <a-scene press-key-board>
			<a-assets timeout="10000">
				<a-asset-item id="hand" src="./sub-hand.glb"></a-asset-item>
				<!-- <a-asset-item id="hand" src="./model/sub-hand.glb"></a-asset-item> -->
        <!-- <img  id="img" src="https://ishizakitakayuki913.github.io/model-data/piece3.png"></img> -->
			</a-assets>
      <a-sky color="#4CC3D9"></a-sky>
      <a-plane position="0 0 0" rotation="-90 0 0" color="#55C" height="20" width="20"></a-plane>

      <a-entity position="0 2 0" rotation="0 0 0">
        <a-entity
        id="hand"
        position="0 0 0"
        rotation="0 0 0"
        gltf-model="#hand"
        animation-mixer="clip: idol.1; loop: repeat"
        scale="10 10 10"
        shadow="receive: false">
        </a-entity>

        <a-entity id="center" position="0 0 0">
          <!-- <a-box id="center1" position="0 1.5 0" width="0.9" height="0.01" depth="0.9" color="#fff"></a-box>
          <a-box id="center2" position="0 -1.5 0" width="0.9" height="0.01" depth="0.9" color="#ef0"></a-box>
          <a-box id="center3" position="0 0 1.5" width="0.9" height="0.9" depth="0.01" color="#0f0"></a-box>
          <a-box id="center4" position="0 0 -1.5" width="0.9" height="0.9" depth="0.01" color="#00f"></a-box>
          <a-box id="center5" position="1.5 0 0" width="0.01" height="0.9" depth="0.9" color="#f00"></a-box>
          <a-box id="center6" position="-1.5 0 0" width="0.01" height="0.9" depth="0.9" color="#f80"></a-box> -->
          
          <a-cylinder id="center1" position="0 1.5 0" rotation="0 0 0" radius="0.45" height="0.01" color="#fff"></a-cylinder>
          <a-cylinder id="center2" position="0 -1.5 0" rotation="0 0 0" radius="0.45" height="0.01" color="#ef0"></a-cylinder>
          <a-cylinder id="center3" position="0 0 1.5" rotation="90 0 0" radius="0.45" height="0.01" color="#0f0"></a-cylinder>
          <a-cylinder id="center4" position="0 0 -1.5" rotation="90 0 0" radius="0.45" height="0.01" color="#00f"></a-cylinder>
          <a-cylinder id="center5" position="1.5 0 0" rotation="0 0 90" radius="0.45" height="0.01" color="#f00"></a-cylinder>
          <a-cylinder id="center6" position="-1.5 0 0" rotation="0 0 90" radius="0.45" height="0.01" color="#f80"></a-cylinder>
        </a-entity>

        <a-entity id="edge" position="0 0 0">
          <a-entity id="edge0" quaterinon-rotation position="0 0 0">
            <a-box position="-1 0 -1.5" width="1" height="0.9" depth="0.01" color="#00f"></a-box>
            <a-box position="-1.5 0 -1" width="0.01" height="0.9" depth="1" color="#f80"></a-box>
            <a-box position="-1 0 -1" width="1" height="0.9" depth="1" color="#AAA"></a-box>
          </a-entity>
          
          <a-entity id="edge1" quaterinon-rotation position="0 0 0">
            <a-box position="1 0 -1.5" width="1" height="0.9" depth="0.01" color="#00f"></a-box>
            <a-box position="1.5 0 -1" width="0.01" height="0.9" depth="1" color="#f00"></a-box>
            <a-box position="1 0 -1" width="1" height="0.9" depth="1" color="#AAA"></a-box>
          </a-entity>
          
          <a-entity id="edge2" quaterinon-rotation position="0 0 0">
            <a-box position="1 0 1.5" width="1" height="0.9" depth="0.01" color="#0f0"></a-box>
            <a-box position="1.5 0 1" width="0.01" height="0.9" depth="1" color="#f00"></a-box>
            <a-box position="1 0 1" width="1" height="0.9" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="edge3" quaterinon-rotation position="0 0 0">
            <a-box position="-1 0 1.5" width="1" height="0.9" depth="0.01" color="#0f0"></a-box>
            <a-box position="-1.5 0 1" width="0.01" height="0.9" depth="1" color="#f80"></a-box>
            <a-box position="-1 0 1" width="1" height="0.9" depth="1" color="#AAA"></a-box>
          </a-entity>
          
          <a-entity id="edge4" quaterinon-rotation position="0 0 0">
            <a-box position="0 1.5 -1" width="0.9" height="0.01" depth="1" color="#fff"></a-box>
            <a-box position="0 1 -1.5" width="0.9" height="1" depth="0.01" color="#00f"></a-box>
            <a-box position="0 1 -1" width="0.9" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="edge5" quaterinon-rotation position="0 0 0">
            <a-box position="1 1.5 0" width="1" height="0.01" depth="0.9" color="#fff"></a-box>
            <a-box position="1.5 1 0" width="0.01" height="1" depth="0.9" color="#f00"></a-box>
            <a-box position="1 1 0" width="1" height="1" depth="0.9" color="#AAA"></a-box>
          </a-entity>
          
          <a-entity id="edge6" quaterinon-rotation position="0 0 0">
            <a-box position="0 1.5 1" width="0.9" height="0.01" depth="1" color="#fff"></a-box>
            <a-box position="0 1 1.5" width="0.9" height="1" depth="0.01" color="#0f0"></a-box>
            <a-box position="0 1 1" width="0.9" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="edge7" quaterinon-rotation position="0 0 0">
            <a-box position="-1 1.5 0" width="1" height="0.01" depth="0.9" color="#fff"></a-box>
            <a-box position="-1.5 1 0" width="0.01" height="1" depth="0.9" color="#f80"></a-box>
            <a-box position="-1 1 0" width="1" height="1" depth="0.9" color="#AAA"></a-box>
          </a-entity>
          
          <a-entity id="edge8" quaterinon-rotation position="0 0 0">
            <a-box position="0 -1.5 -1" width="0.9" height="0.01" depth="1" color="#ef0"></a-box>
            <a-box position="0 -1 -1.5" width="0.9" height="1" depth="0.01" color="#00f"></a-box>
            <a-box position="0 -1 -1" width="0.9" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>
          
          <a-entity id="edge9" quaterinon-rotation position="0 0 0">
            <a-box position="1 -1.5 0" width="1" height="0.01" depth="0.9" color="#ef0"></a-box>
            <a-box position="1.5 -1 0" width="0.01" height="1" depth="0.9" color="#f00"></a-box>
            <a-box position="1 -1 0" width="1" height="1" depth="0.9" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="edge10" quaterinon-rotation position="0 0 0">
            <a-box position="0 -1.5 1" width="0.9" height="0.01" depth="1" color="#ef0"></a-box>
            <a-box position="0 -1 1.5" width="0.9" height="1" depth="0.01" color="#0f0"></a-box>
            <a-box position="0 -1 1" width="0.9" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="edge11" quaterinon-rotation position="0 0 0">
            <a-box position="-1 -1.5 0" width="1" height="0.01" depth="0.9" color="#ef0"></a-box>
            <a-box position="-1.5 -1 0" width="0.01" height="1" depth="0.9" color="#f80"></a-box>
            <a-box position="-1 -1 0" width="1" height="1" depth="0.9" color="#AAA"></a-box>
          </a-entity>
        </a-entity>

        <a-entity id="corner" position="0 0 0">
          <a-entity id="corner0" quaterinon-rotation position="0 0 0">
            <a-box position="-1 1.5 -1" width="1" height="0.01" depth="1" color="#fff"></a-box>
            <a-box position="-1.5 1 -1" width="0.01" height="1" depth="1" color="#f80"></a-box>
            <a-box position="-1 1 -1.5" width="1" height="1" depth="0.01" color="#00F"></a-box>
            <a-box position="-1 1 -1" width="1" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="corner1" quaterinon-rotation position="0 0 0">
            <a-box position="1 1.5 -1" width="1" height="0.01" depth="1" color="#fff"></a-box>
            <a-box position="1 1 -1.5" width="1" height="1" depth="0.01" color="#00F"></a-box>
            <a-box position="1.5 1 -1" width="0.01" height="1" depth="1" color="#f00"></a-box>
            <a-box position="1 1 -1" width="1" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="corner2" quaterinon-rotation position="0 0 0">
            <a-box position="1 1.5 1" width="1" height="0.01" depth="1" color="#fff"></a-box>
            <a-box position="1.5 1 1" width="0.01" height="1" depth="1" color="#f00"></a-box>
            <a-box position="1 1 1.5" width="1" height="1" depth="0.01" color="#0f0"></a-box>
            <a-box position="1 1 1" width="1" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="corner3" quaterinon-rotation position="0 0 0">
            <a-box position="-1 1.5 1" width="1" height="0.01" depth="1" color="#fff"></a-box>
            <a-box position="-1 1 1.5" width="1" height="1" depth="0.01" color="#0f0"></a-box>
            <a-box position="-1.5 1 1" width="0.01" height="1" depth="1" color="#f80"></a-box>
            <a-box position="-1 1 1" width="1" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="corner4" quaterinon-rotation position="0 0 0">
            <a-box position="-1 -1.5 -1" width="1" height="0.01" depth="1" color="#ef0"></a-box>
            <a-box position="-1 -1 -1.5" width="1" height="1" depth="0.01" color="#00F"></a-box>
            <a-box position="-1.5 -1 -1" width="0.01" height="1" depth="1" color="#f80"></a-box>
            <a-box position="-1 -1 -1" width="1" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="corner5" quaterinon-rotation position="0 0 0">
            <a-box position="1 -1.5 -1" width="1" height="0.01" depth="1" color="#ef0"></a-box>
            <a-box position="1.5 -1 -1" width="0.01" height="1" depth="1" color="#f00"></a-box>
            <a-box position="1 -1 -1.5" width="1" height="1" depth="0.01" color="#00F"></a-box>
            <a-box position="1 -1 -1" width="1" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="corner6" quaterinon-rotation position="0 0 0">
            <a-box position="1 -1.5 1" width="1" height="0.01" depth="1" color="#ef0"></a-box>
            <a-box position="1 -1 1.5" width="1" height="1" depth="0.01" color="#0f0"></a-box>
            <a-box position="1.5 -1 1" width="0.01" height="1" depth="1" color="#f00"></a-box>
            <a-box position="1 -1 1" width="1" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>

          <a-entity id="corner7" quaterinon-rotation position="0 0 0">
            <a-box position="-1 -1.5 1" width="1" height="0.01" depth="1" color="#ef0"></a-box>
            <a-box position="-1.5 -1 1" width="0.01" height="1" depth="1" color="#f80"></a-box>
            <a-box position="-1 -1 1.5" width="1" height="1" depth="0.01" color="#0f0"></a-box>
            <a-box position="-1 -1 1" width="1" height="1" depth="1" color="#AAA"></a-box>
          </a-entity>
        </a-entity>
      </a-entity> 
      
      <a-entity id="camera" position="0 2 0" rotation="0 0 0">
        <a-camera id="camera2" cube-control look-controls="enabled: false" wasd-controls-enabled="false" position="0 0 6" rotation="0 0 0">
          <!-- wasd-controls-enabled="false" -->
          <!-- <a-entity cursor="rayOrigin: mouse" /> -->
        </a-camera>
      </a-entity>
    </a-scene>

    <div id="screen"></div>
    <div id="btn1" class="btn"></div>
    <div id="btn2" class="btn">
        <canvas id="canvas"></canvas>
    </div>
  </body>
</html>
